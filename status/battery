#!/bin/sh

# This script is run evry 5 seconds with dwmblocks and displays a
# battery indicator in the status bar.

notify() {
    dunstify --appname="battery" --replace=1 "$1" "$2" --urgency "$3"
}

icon=""

capacity=$(cat /sys/class/power_supply/BAT0/capacity) || \
    $(cat /sys/class/power_supply/BAT1/capacity)

status=$(cat /sys/class/power_supply/BAT0/status) || \
    $(cat /sys/class/power_supply/BAT1/status)

if [ "$capacity" -le 75 ] && [ "$capacity" -gt 50 ]; then
    icon=""
elif [ "$capacity" -le 50 ] && [ "$capacity" -gt 30 ]; then
    icon=""
elif [ "$capacity" -le 30 ] && [ "$capacity" -gt 20 ]; then
    icon=""
elif [ "$capacity" -le 20 ]; then
    icon=""
    [ "$status" != "Charging" ] && notify "Low battery level!" "" 2
fi

printf "%s\n" "$icon"

case $BUTTON in
    1) notify "Battery: $capacity%" "$status";;
esac
