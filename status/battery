#!/bin/sh

# This script is run evry 5 seconds with dwmblocks and displays a
# battery indicator in the status bar.

notify() {
    dunstify --appname="battery" --replace=1 "$1" "$2" --urgency="$3" --timeout="$4"
}

icon=""

if [ -d /sys/class/power_supply/BAT0 ]; then
    capacity=$(cat /sys/class/power_supply/BAT0/capacity)
    status=$(cat /sys/class/power_supply/BAT0/status)
elif [ -d /sys/class/power_supply/BAT1 ]; then
    capacity=$(cat /sys/class/power_supply/BAT1/capacity)
    status=$(cat /sys/class/power_supply/BAT1/status)
fi

if [ "$capacity" -le 75 ] && [ "$capacity" -gt 50 ]; then
    icon=""
elif [ "$capacity" -le 50 ] && [ "$capacity" -gt 30 ]; then
    icon=""
elif [ "$capacity" -le 30 ] && [ "$capacity" -gt 20 ]; then
    icon=""
elif [ "$capacity" -le 20 ]; then
    icon=""
    [ "$status" != "Charging" ] && notify "Low battery level!" "" 2 0
fi

printf "%s\n" "$icon"

case $BUTTON in
    1) notify "Battery: $capacity%" "$status" 1 7000;;
esac
